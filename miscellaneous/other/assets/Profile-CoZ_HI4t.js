import{_ as D,u as T,g as P,f as c,B as j,c as y,a as d,d as o,w as r,r as n,C as k,E as f,h as z,o as V,i as m,q as C,I as G,R as H}from"./index-D8Pz7pGe.js";import{g as J,u as K,c as O}from"./users-CEgrc9KV.js";const Q={class:"profile-container"},W={class:"header-section"},X={class:"profile-content"},Y={class:"profile-menu"},Z={class:"profile-detail"},$={key:0,class:"profile-form"},ee={key:1,class:"security-form"},oe={__name:"Profile",setup(re){const q=T(),B=z(),F=()=>{B.go(-1)},g=P("profile"),l=c({name:"",phone_number:"",gender:null,age:null}),s=c({currentPassword:"",newPassword:"",confirmPassword:""}),_=P(!1),w=P(!1),h=c({name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度在2到20个字符",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],age:[{type:"number",min:0,max:150,message:"年龄必须在0到150之间",trigger:"blur"}]}),S=c({currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6到20个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(t,e,i)=>{e!==s.newPassword?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]}),E=t=>{g.value=t},M=async()=>{try{const e=(await J()).data;l.name=e.name,l.phone_number=e.phone_number,l.gender=e.gender,l.age=e.age}catch(t){f.error("获取用户信息失败: "+t.message)}},N=async()=>{try{_.value=!0,await K({name:l.name,gender:l.gender,age:l.age}),q.updateUserProfile({name:l.name,gender:l.gender,age:l.age}),f.success("个人信息更新成功")}catch(t){f.error("更新失败: "+t.message)}finally{_.value=!1}},R=async()=>{try{w.value=!0,await O({currentPassword:s.currentPassword,newPassword:s.newPassword}),s.currentPassword="",s.newPassword="",s.confirmPassword="",f.success("密码修改成功")}catch(t){f.error("修改密码失败: "+t.message)}finally{w.value=!1}};return j(()=>{M()}),(t,e)=>{const i=n("el-button"),v=n("el-icon"),x=n("el-menu-item"),I=n("el-menu"),p=n("el-input"),u=n("el-form-item"),b=n("el-radio"),L=n("el-radio-group"),A=n("el-input-number"),U=n("el-form");return V(),y("div",Q,[d("div",W,[o(i,{icon:"Back",onClick:F},{default:r(()=>[...e[7]||(e[7]=[m("返回",-1)])]),_:1}),e[8]||(e[8]=d("h1",{class:"profile-title"},"个人中心",-1))]),d("div",X,[d("div",Y,[o(I,{"default-active":g.value,class:"menu",onSelect:E},{default:r(()=>[o(x,{index:"profile"},{default:r(()=>[o(v,null,{default:r(()=>[o(C(G))]),_:1}),e[9]||(e[9]=d("span",null,"基本资料",-1))]),_:1}),o(x,{index:"security"},{default:r(()=>[o(v,null,{default:r(()=>[o(C(H))]),_:1}),e[10]||(e[10]=d("span",null,"安全设置",-1))]),_:1})]),_:1},8,["default-active"])]),d("div",Z,[g.value==="profile"?(V(),y("div",$,[o(U,{ref:"profileForm",model:l,rules:h,"label-width":"100px","label-position":"top"},{default:r(()=>[o(u,{label:"姓名",prop:"name"},{default:r(()=>[o(p,{modelValue:l.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),o(u,{label:"联系电话",prop:"phone_number"},{default:r(()=>[o(p,{modelValue:l.phone_number,"onUpdate:modelValue":e[1]||(e[1]=a=>l.phone_number=a),placeholder:"请输入联系电话",disabled:""},null,8,["modelValue"])]),_:1}),o(u,{label:"性别",prop:"gender"},{default:r(()=>[o(L,{modelValue:l.gender,"onUpdate:modelValue":e[2]||(e[2]=a=>l.gender=a)},{default:r(()=>[o(b,{label:1},{default:r(()=>[...e[11]||(e[11]=[m("男",-1)])]),_:1}),o(b,{label:2},{default:r(()=>[...e[12]||(e[12]=[m("女",-1)])]),_:1}),o(b,{label:3},{default:r(()=>[...e[13]||(e[13]=[m("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(u,{label:"年龄",prop:"age"},{default:r(()=>[o(A,{modelValue:l.age,"onUpdate:modelValue":e[3]||(e[3]=a=>l.age=a),min:0,max:150,"controls-position":"right"},null,8,["modelValue"])]),_:1}),o(u,null,{default:r(()=>[o(i,{type:"primary",onClick:N,loading:_.value},{default:r(()=>[...e[14]||(e[14]=[m(" 保存修改 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])):k("",!0),g.value==="security"?(V(),y("div",ee,[o(U,{ref:"securityForm",model:s,rules:S,"label-width":"100px","label-position":"top"},{default:r(()=>[o(u,{label:"当前密码",prop:"currentPassword"},{default:r(()=>[o(p,{modelValue:s.currentPassword,"onUpdate:modelValue":e[4]||(e[4]=a=>s.currentPassword=a),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),o(u,{label:"新密码",prop:"newPassword"},{default:r(()=>[o(p,{modelValue:s.newPassword,"onUpdate:modelValue":e[5]||(e[5]=a=>s.newPassword=a),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(u,{label:"确认新密码",prop:"confirmPassword"},{default:r(()=>[o(p,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=a=>s.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(u,null,{default:r(()=>[o(i,{type:"primary",onClick:R,loading:w.value},{default:r(()=>[...e[15]||(e[15]=[m(" 修改密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])):k("",!0)])])])}}},ae=D(oe,[["__scopeId","data-v-be68d040"]]);export{ae as default};
