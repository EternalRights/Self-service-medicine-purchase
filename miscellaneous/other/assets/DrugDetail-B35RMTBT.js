import{_ as L,z as U,g as y,p as C,B as $,c as _,a as e,d as a,w as n,r as i,q as l,G as o,S as F,J as D,A as G,E as r,h as J,o as c,i as p,C as P}from"./index-BRfkWvBv.js";import{D as u,g as j}from"./drug-BLw-O-3C.js";import{u as K}from"./cart-BX6S-Glw.js";import{u as Q}from"./notification-DqAp0EGn.js";import{n as w}from"./no-drugs-DbQaxHLo.js";const W={class:"drug-detail-container"},Y={class:"header-section"},Z={key:0,class:"drug-card"},ee={class:"drug-header"},te={class:"drug-basic-info"},se={class:"drug-name"},oe={class:"drug-category"},ae={class:"drug-specification"},ne={class:"drug-manufacturer"},ie={class:"drug-price"},le={class:"price-value"},re={class:"drug-stock"},ce={class:"drug-actions"},ue={class:"drug-details"},de={class:"detail-section"},_e={class:"section-content"},pe={class:"detail-section"},ge={class:"section-content"},me={class:"detail-section"},ve={class:"section-content"},fe={class:"detail-section"},ye={class:"section-content"},ke={key:0,class:"prescription-warning"},he={class:"detail-section"},be={class:"section-content"},Ce={class:"detail-section"},De={class:"section-content"},we={key:1,class:"loading-container"},xe={key:2,class:"not-found"},Te=["src"],Se={__name:"DrugDetail",setup(qe){const x=G(),k=J(),g=U(),T=K(),S=Q(),s=y(null),v=y(!0),h=y("info"),q=C(()=>{if(!s.value)return"";switch(s.value.category){case u.OTC:return"非处方药(OTC)";case u.RX:return"处方药(Rx)";case u.MEDICAL:return"医疗器械";case u.HEALTH:return"保健养生";default:return"其他"}}),B=C(()=>s.value?s.value.stock_quantity<=0?"stock-out":s.value.stock_quantity<=10?"stock-low":"stock-normal":""),O=async()=>{try{v.value=!0;const d=parseInt(x.params.id),t=await j(d);s.value=t}catch(d){r.error("获取药品详情失败: "+d.message),s.value=null}finally{v.value=!1}},V=async()=>{if(!g.isOpen){r.warning("暂停营业中，无法添加商品");return}if(s.value.stock_quantity<=0){r.warning("该药品已售罄");return}try{await T.addItem({drug_id:s.value.id,quantity:1}),r.success({message:"已成功加入购物车",duration:1500})}catch(d){r.error("加入购物车失败: "+d.message)}},N=()=>{if(!g.isOpen){r.warning("暂停营业中，无法咨询");return}S.addNotification({user_id:1,message_type:1,title:`药品咨询: ${s.value.generic_name}`,content:`用户咨询关于${s.value.generic_name}的使用信息`}),r.success({message:"已为您发起用药咨询请求，药师将尽快与您联系",duration:3e3})},R=()=>{k.go(-1)},z=()=>{k.push({name:"UserHome"})};return $(()=>{O()}),(d,t)=>{var b;const m=i("el-button"),E=i("el-image"),I=i("el-tag"),f=i("el-tab-pane"),A=i("el-alert"),H=i("el-tabs"),M=i("el-skeleton");return c(),_("div",W,[e("div",Y,[a(m,{icon:"Back",onClick:R},{default:n(()=>[...t[1]||(t[1]=[p("返回",-1)])]),_:1}),t[2]||(t[2]=e("h1",{class:"page-title"},"药品详情",-1))]),s.value?(c(),_("div",Z,[e("div",ee,[a(E,{src:s.value.image||l(w),class:"drug-image",fit:"cover"},null,8,["src"]),e("div",te,[e("h2",se,o(s.value.generic_name),1),e("div",oe,[a(I,{type:s.value.category===l(u).RX?"danger":"success",size:"large"},{default:n(()=>[p(o(q.value),1)]),_:1},8,["type"])]),e("div",ae,[e("span",null,"规格："+o(s.value.specification||"暂无"),1)]),e("div",ne,[e("span",null,"生产厂商："+o(s.value.manufacturer||"暂无"),1)]),e("div",ie,[t[3]||(t[3]=e("span",{class:"price-label"},"价格：",-1)),e("span",le,"¥"+o(((b=s.value.price)==null?void 0:b.toFixed(2))||"0.00"),1)]),e("div",re,[t[4]||(t[4]=e("span",null,"库存：",-1)),e("span",{class:F(B.value)},o(s.value.stock_quantity)+"件",3)]),e("div",ce,[s.value.category===l(u).OTC?(c(),D(m,{key:0,type:"primary",size:"large",disabled:!l(g).isOpen||s.value.stock_quantity<=0,onClick:V},{default:n(()=>[...t[5]||(t[5]=[p(" 加入购物车 ",-1)])]),_:1},8,["disabled"])):(c(),D(m,{key:1,type:"primary",size:"large",disabled:!l(g).isOpen,onClick:N},{default:n(()=>[...t[6]||(t[6]=[p(" 咨询药师 ",-1)])]),_:1},8,["disabled"]))])])]),e("div",ue,[a(H,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=X=>h.value=X),class:"drug-tabs"},{default:n(()=>[a(f,{label:"药品信息",name:"info"},{default:n(()=>[e("div",de,[t[7]||(t[7]=e("h3",{class:"section-title"},"成分",-1)),e("p",_e,o(s.value.composition||"暂无信息"),1)]),e("div",pe,[t[8]||(t[8]=e("h3",{class:"section-title"},"适应症",-1)),e("p",ge,o(s.value.indications||"暂无信息"),1)]),e("div",me,[t[9]||(t[9]=e("h3",{class:"section-title"},"用法用量",-1)),e("p",ve,o(s.value.usage_dosage||"暂无信息"),1)])]),_:1}),a(f,{label:"注意事项",name:"precautions"},{default:n(()=>[e("div",fe,[e("p",ye,o(s.value.precautions||"暂无注意事项"),1)]),s.value.category===l(u).RX?(c(),_("div",ke,[a(A,{title:"处方药警示",type:"error",closable:!1,"show-icon":""},{default:n(()=>[...t[10]||(t[10]=[e("p",null,"本药品为处方药，请凭医师处方购买和使用",-1)])]),_:1})])):P("",!0)]),_:1}),a(f,{label:"其他信息",name:"other"},{default:n(()=>[e("div",he,[t[11]||(t[11]=e("h3",{class:"section-title"},"有效期",-1)),e("p",be,o(s.value.expiry_date||"暂无信息"),1)]),e("div",Ce,[t[12]||(t[12]=e("h3",{class:"section-title"},"生产批号",-1)),e("p",De,o(s.value.batch_number||"暂无信息"),1)])]),_:1})]),_:1},8,["modelValue"])])])):v.value?(c(),_("div",we,[a(M,{rows:5,animated:""})])):(c(),_("div",xe,[e("img",{src:l(w),alt:"药品不存在",class:"not-found-image"},null,8,Te),t[14]||(t[14]=e("p",{class:"not-found-text"},"抱歉，未找到该药品信息",-1)),a(m,{type:"primary",onClick:z},{default:n(()=>[...t[13]||(t[13]=[p("返回首页",-1)])]),_:1})]))])}}},ze=L(Se,[["__scopeId","data-v-9ca2df69"]]);export{ze as default};
