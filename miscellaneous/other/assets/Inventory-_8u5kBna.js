import{_ as te,g as i,f as oe,B as ne,c as B,d as a,w as t,r as n,E as w,a5 as re,o as S,a as d,F as ue,q as se,H as ie,N as de,O as pe,a6 as ce,J as me,G as h,i as v,S as _e}from"./index-CwdkBvns.js";import{D as c,a as ve,b as ge,e as fe}from"./drug-CXf0Pc3g.js";const be={class:"inventory-management"},ye={class:"toolbar"},Ve={class:"filter-section"},he={class:"drug-info"},Ce={class:"drug-details"},we={class:"drug-name"},ke={class:"drug-spec"},xe={class:"drug-manufacturer"},De={class:"pagination-container"},qe={__name:"Inventory",setup(ze){const I=[{value:c.OTC,label:"非处方药(OTC)"},{value:c.RX,label:"处方药(Rx)"},{value:c.MEDICAL,label:"医疗器械"},{value:c.HEALTH,label:"保健养生"}],U=i([]),k=i(!1),r=oe({page:1,pageSize:10,total:0}),x=i(""),D=i(null),g=i(null),f=i(!1),p=i(null),u=i({quantity:1,batch_number:"",production_date:"",expiry_date:""}),R=i(null),H={quantity:[{required:!0,message:"请输入入库数量",trigger:"blur"},{type:"number",min:1,message:"数量必须大于0",trigger:"blur"}],batch_number:[{required:!0,message:"请输入生产批号",trigger:"blur"}],production_date:[{required:!0,message:"请选择生产日期",trigger:"change"}],expiry_date:[{required:!0,message:"请选择有效期",trigger:"change"}]},C=i(!1),L=i([]),b=async()=>{try{k.value=!0;const o={page:r.page,pageSize:r.pageSize,keyword:x.value,category:D.value};g.value!==null&&g.value!==void 0&&(o.low_stock=g.value);const l=await ve(o);U.value=l.data.items,r.total=l.data.total}catch(o){w.error("获取库存列表失败: "+o.message)}finally{k.value=!1}},y=()=>{r.page=1,b()},O=o=>{r.pageSize=o,b()},N=o=>{r.page=o,b()},K=o=>{p.value=o,u.value={quantity:1,batch_number:"",production_date:"",expiry_date:""},f.value=!0},j=async()=>{try{await R.value.validate(),await fe(p.value.id,u.value),w.success("入库成功"),f.value=!1,b()}catch(o){o.name!=="ValidationError"&&w.error("入库失败: "+o.message)}},P=async o=>{p.value=o;try{const l=await ge(o.id);L.value=l.data,C.value=!0}catch(l){w.error("获取库存记录失败: "+l.message)}},X=o=>{switch(o){case c.OTC:return"success";case c.RX:return"warning";case c.MEDICAL:return"info";case c.HEALTH:return"";default:return"info"}},G=o=>{const l=I.find(q=>q.value===o);return l?l.label:"未知"};return ne(()=>{b()}),(o,l)=>{var $,A;const q=n("el-icon"),_=n("el-button"),V=n("el-input"),z=n("el-option"),E=n("el-select"),M=n("el-card"),s=n("el-table-column"),J=n("el-image"),Q=n("el-tag"),T=n("el-table"),W=n("el-pagination"),m=n("el-form-item"),Z=n("el-input-number"),Y=n("el-date-picker"),ee=n("el-form"),F=n("el-dialog"),ae=re("loading");return S(),B("div",be,[a(M,{class:"toolbar-card",shadow:"never"},{default:t(()=>[d("div",ye,[d("div",Ve,[a(V,{modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=e=>x.value=e),placeholder:"搜索药品名称",clearable:"",class:"search-input",onClear:y,onKeyup:ue(y,["enter"])},{append:t(()=>[a(_,{onClick:y},{default:t(()=>[a(q,null,{default:t(()=>[a(se(ie))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(E,{modelValue:D.value,"onUpdate:modelValue":l[1]||(l[1]=e=>D.value=e),placeholder:"全部分类",clearable:"",onChange:y},{default:t(()=>[(S(),B(de,null,pe(I,e=>a(z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(E,{modelValue:g.value,"onUpdate:modelValue":l[2]||(l[2]=e=>g.value=e),placeholder:"库存状态",clearable:"",onChange:y},{default:t(()=>[a(z,{label:"正常",value:!1}),a(z,{label:"低库存",value:!0})]),_:1},8,["modelValue"])])])]),_:1}),a(M,{class:"inventory-list-card",shadow:"never"},{default:t(()=>[ce((S(),me(T,{data:U.value,style:{width:"100%"},"header-cell-style":{background:"#0F1420",color:"#fff"},"row-class-name":"inventory-table-row"},{default:t(()=>[a(s,{prop:"id",label:"ID",width:"80"}),a(s,{label:"药品信息","min-width":"300"},{default:t(({row:e})=>[d("div",he,[a(J,{src:e.image||require("@/assets/no-drugs.png"),fit:"cover",class:"drug-image"},null,8,["src"]),d("div",Ce,[d("div",we,h(e.generic_name),1),d("div",ke,h(e.specification),1),d("div",xe,h(e.manufacturer),1)])])]),_:1}),a(s,{label:"分类",width:"120"},{default:t(({row:e})=>[a(Q,{type:X(e.category)},{default:t(()=>[v(h(G(e.category)),1)]),_:2},1032,["type"])]),_:1}),a(s,{label:"当前库存",width:"120"},{default:t(({row:e})=>[d("span",{class:_e({"low-stock":e.stock_quantity<10})},h(e.stock_quantity),3)]),_:1}),a(s,{label:"操作",width:"200",fixed:"right"},{default:t(({row:e})=>[a(_,{type:"primary",size:"small",onClick:le=>K(e)},{default:t(()=>[...l[13]||(l[13]=[v(" 入库 ",-1)])]),_:1},8,["onClick"]),a(_,{type:"info",size:"small",onClick:le=>P(e)},{default:t(()=>[...l[14]||(l[14]=[v(" 记录 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,k.value]]),d("div",De,[a(W,{"current-page":r.page,"onUpdate:currentPage":l[3]||(l[3]=e=>r.page=e),"page-size":r.pageSize,"onUpdate:pageSize":l[4]||(l[4]=e=>r.pageSize=e),total:r.total,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:O,onCurrentChange:N},null,8,["current-page","page-size","total"])])]),_:1}),a(F,{modelValue:f.value,"onUpdate:modelValue":l[10]||(l[10]=e=>f.value=e),title:`药品入库 - ${($=p.value)==null?void 0:$.generic_name}`,width:"600px"},{footer:t(()=>[a(_,{onClick:l[9]||(l[9]=e=>f.value=!1)},{default:t(()=>[...l[15]||(l[15]=[v("取消",-1)])]),_:1}),a(_,{type:"primary",onClick:j},{default:t(()=>[...l[16]||(l[16]=[v("提交",-1)])]),_:1})]),default:t(()=>[a(ee,{ref_key:"inventoryFormRef",ref:R,model:u.value,rules:H,"label-width":"100px"},{default:t(()=>[a(m,{label:"药品名称"},{default:t(()=>{var e;return[a(V,{value:(e=p.value)==null?void 0:e.generic_name,disabled:""},null,8,["value"])]}),_:1}),a(m,{label:"规格"},{default:t(()=>{var e;return[a(V,{value:(e=p.value)==null?void 0:e.specification,disabled:""},null,8,["value"])]}),_:1}),a(m,{label:"当前库存"},{default:t(()=>{var e;return[a(V,{value:(e=p.value)==null?void 0:e.stock_quantity,disabled:""},null,8,["value"])]}),_:1}),a(m,{label:"入库数量",prop:"quantity"},{default:t(()=>[a(Z,{modelValue:u.value.quantity,"onUpdate:modelValue":l[5]||(l[5]=e=>u.value.quantity=e),min:1,max:1e4,"controls-position":"right"},null,8,["modelValue"])]),_:1}),a(m,{label:"生产批号",prop:"batch_number"},{default:t(()=>[a(V,{modelValue:u.value.batch_number,"onUpdate:modelValue":l[6]||(l[6]=e=>u.value.batch_number=e)},null,8,["modelValue"])]),_:1}),a(m,{label:"生产日期",prop:"production_date"},{default:t(()=>[a(Y,{modelValue:u.value.production_date,"onUpdate:modelValue":l[7]||(l[7]=e=>u.value.production_date=e),type:"date",placeholder:"选择生产日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(m,{label:"有效期至",prop:"expiry_date"},{default:t(()=>[a(Y,{modelValue:u.value.expiry_date,"onUpdate:modelValue":l[8]||(l[8]=e=>u.value.expiry_date=e),type:"date",placeholder:"选择有效期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(F,{modelValue:C.value,"onUpdate:modelValue":l[12]||(l[12]=e=>C.value=e),title:`库存记录 - ${(A=p.value)==null?void 0:A.generic_name}`,width:"800px"},{footer:t(()=>[a(_,{onClick:l[11]||(l[11]=e=>C.value=!1)},{default:t(()=>[...l[17]||(l[17]=[v("关闭",-1)])]),_:1})]),default:t(()=>[a(T,{data:L.value,height:"400"},{default:t(()=>[a(s,{prop:"batch_number",label:"批号",width:"120"}),a(s,{prop:"quantity",label:"数量",width:"80"}),a(s,{prop:"production_date",label:"生产日期",width:"120"}),a(s,{prop:"expiry_date",label:"有效期",width:"120"}),a(s,{prop:"create_time",label:"入库时间",width:"180"}),a(s,{prop:"create_user_name",label:"操作人"})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}}},Ue=te(qe,[["__scopeId","data-v-d6d721e8"]]);export{Ue as default};
