import{_ as W,g as h,p as I,B as X,c as b,o as u,a as t,d as l,J as x,C as P,w as s,q as N,a4 as re,S as O,r as p,i as v,G as r,N as M,O as S,a3 as ue,$ as Y,f as ce,E as z,a5 as pe,F as _e,H as ve,a6 as me}from"./index-D8Pz7pGe.js";import{u as fe,M as G,f as ge}from"./notification-CE5PZsFL.js";const be={class:"header-left"},ye={class:"header-right"},he={class:"notification-body"},Ce={class:"notification-list"},ke={class:"notification-content"},Ee={class:"notification-title"},we={key:0,class:"priority-tag"},De={class:"notification-message"},Ne={class:"notification-time"},Re={class:"notification-actions"},Pe={key:0,class:"empty-notification"},Ve={__name:"RealTimeNotification",setup(d){const C=fe(),k=h(!0),f=I(()=>C.notifications),m=I(()=>C.unreadCount),R=()=>{k.value=!k.value},y=o=>{C.markAsRead(o)},w=()=>{C.markAllAsRead()},V=o=>{console.log("处理用药咨询",o),y(o.id)};return X(()=>{}),(o,_)=>{const D=p("el-icon"),L=p("el-tag"),E=p("el-button");return u(),b("div",{class:O(["real-time-notification",{expanded:k.value}])},[t("div",{class:"notification-header",onClick:R},[t("div",be,[l(D,{class:O(["toggle-icon",{rotate:k.value}])},{default:s(()=>[l(N(re))]),_:1},8,["class"]),_[0]||(_[0]=t("span",{class:"header-title"},"实时消息看板",-1)),m.value>0?(u(),x(L,{key:0,type:"danger",class:"unread-count"},{default:s(()=>[v(r(m.value)+"条未读 ",1)]),_:1})):P("",!0)]),t("div",ye,[l(E,{type:"text",onClick:w},{default:s(()=>[..._[1]||(_[1]=[v(" 全部标记为已读 ",-1)])]),_:1})])]),t("div",he,[t("div",Ce,[(u(!0),b(M,null,S(f.value,c=>(u(),b("div",{key:c.id,class:O(["notification-item",{unread:!c.isRead,"high-priority":c.message_type===N(G).MEDICAL_CONSULT}])},[t("div",ke,[t("div",Ee,[c.message_type===N(G).MEDICAL_CONSULT?(u(),b("span",we,[l(D,null,{default:s(()=>[l(N(ue))]),_:1}),_[2]||(_[2]=v(" 高优先级 ",-1))])):P("",!0),v(" "+r(c.title),1)]),t("div",De,r(c.content),1),t("div",Ne,r(N(ge)(c.create_time)),1)]),t("div",Re,[c.isRead?P("",!0):(u(),x(E,{key:0,type:"text",size:"small",onClick:T=>y(c.id)},{default:s(()=>[..._[3]||(_[3]=[v(" 标记为已读 ",-1)])]),_:1},8,["onClick"])),c.message_type===N(G).MEDICAL_CONSULT?(u(),x(E,{key:1,type:"primary",size:"small",onClick:T=>V(c)},{default:s(()=>[..._[4]||(_[4]=[v(" 处理咨询 ",-1)])]),_:1},8,["onClick"])):P("",!0)])],2))),128)),f.value.length===0?(u(),b("div",Pe," 暂无新消息 ")):P("",!0)])])],2)}}},$e=W(Ve,[["__scopeId","data-v-64e66a21"]]);var i=(d=>(d[d.PENDING=1]="PENDING",d[d.PREPARING=2]="PREPARING",d[d.READY=3]="READY",d[d.COMPLETED=4]="COMPLETED",d))(i||{});const U={__name:"StatusBadge",props:{status:{type:Number,required:!0}},setup(d){const C=d,k=I(()=>{switch(C.status){case i.PENDING:return"待确认";case i.PREPARING:return"备货中";case i.READY:return"待取货";case i.COMPLETED:return"已完成";default:return"未知状态"}}),f=I(()=>{switch(C.status){case i.PENDING:return"warning";case i.PREPARING:return"primary";case i.READY:return"info";case i.COMPLETED:return"success";default:return"info"}});return(m,R)=>{const y=p("el-tag");return u(),x(y,{type:f.value,effect:"dark"},{default:s(()=>[v(r(k.value),1)]),_:1},8,["type"])}}};function xe(d={}){return Y.get("/api/orders",{params:d})}function Ae(d){return Y.get(`/api/orders/${d}`)}function ze(d){return Y.put("/api/orders/status",d)}const Ie={class:"order-management"},Me={class:"toolbar"},Se={class:"filter-section"},Le={class:"user-info"},Te={class:"user-name"},Oe={class:"user-phone"},Ge={class:"drugs-list"},Ue={class:"drug-name"},Ye={class:"drug-quantity"},Fe={class:"pagination-container"},Be={key:0,class:"order-detail"},qe={class:"detail-section"},Ke={class:"detail-header"},je={class:"detail-info"},He={class:"detail-item"},Je={class:"detail-item"},Qe={class:"detail-item"},We={class:"detail-item"},Xe={class:"detail-value"},Ze={class:"detail-section"},et={class:"user-info"},tt={class:"detail-item"},at={class:"detail-item"},lt={class:"detail-section"},st={key:0,class:"status-update"},ot={__name:"OrderManagement",setup(d){const C=[{value:i.PENDING,label:"待确认",color:"warning"},{value:i.PREPARING,label:"备货中",color:"primary"},{value:i.READY,label:"待取货",color:"info"},{value:i.COMPLETED,label:"已完成",color:"success"}],k=h([]),f=h(!1),m=ce({page:1,pageSize:10,total:0}),R=h(""),y=h(null),w=h([]),V=h(!1),o=h(null),_=h(!1),D=h(null),L=I(()=>{if(!o.value)return[];const n=o.value.order_status,e=[];switch(n){case i.PENDING:e.push({value:i.PREPARING,label:"备货中"});break;case i.PREPARING:e.push({value:i.READY,label:"待取货"});break;case i.READY:e.push({value:i.COMPLETED,label:"已完成"});break}return e}),E=async()=>{try{f.value=!0;const n={page:m.page,pageSize:m.pageSize};R.value&&(n.keyword=R.value),y.value!==null&&y.value!==void 0&&(n.status=y.value),w.value&&w.value.length===2&&(n.startDate=w.value[0],n.endDate=w.value[1]);const e=await xe(n);k.value=e.data.items,m.total=e.data.total}catch(n){z.error("获取订单列表失败: "+n.message)}finally{f.value=!1}},c=()=>{m.page=1,E()},T=n=>{m.pageSize=n,E()},Z=n=>{m.page=n,E()},ee=async n=>{try{f.value=!0;const e=await Ae(n.id);o.value=e.data,V.value=!0}catch(e){z.error("获取订单详情失败: "+e.message)}finally{f.value=!1}},te=n=>{o.value=n,D.value=null,_.value=!0},ae=async()=>{if(!D.value){z.warning("请选择新的订单状态");return}try{f.value=!0,await ze({order_id:o.value.id,new_status:D.value}),z.success("订单状态更新成功"),_.value=!1,E()}catch(n){z.error("状态更新失败: "+n.message)}finally{f.value=!1}};return X(()=>{E()}),(n,e)=>{var J,Q;const le=p("el-icon"),$=p("el-button"),se=p("el-input"),F=p("el-option"),B=p("el-select"),oe=p("el-date-picker"),q=p("el-card"),g=p("el-table-column"),K=p("el-table"),ne=p("el-pagination"),j=p("el-dialog"),H=p("el-form-item"),ie=p("el-form"),de=pe("loading");return u(),b("div",Ie,[l($e),l(q,{class:"toolbar-card",shadow:"never"},{default:s(()=>[t("div",Me,[t("div",Se,[l(se,{modelValue:R.value,"onUpdate:modelValue":e[0]||(e[0]=a=>R.value=a),placeholder:"搜索订单号、用户名",clearable:"",class:"search-input",onClear:c,onKeyup:_e(c,["enter"])},{append:s(()=>[l($,{onClick:c},{default:s(()=>[l(le,null,{default:s(()=>[l(N(ve))]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),placeholder:"全部状态",clearable:"",onChange:c},{default:s(()=>[(u(),b(M,null,S(C,a=>l(F,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l(oe,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",onChange:c},null,8,["modelValue"])])])]),_:1}),l(q,{class:"order-list-card",shadow:"never"},{default:s(()=>[me((u(),x(K,{data:k.value,style:{width:"100%"},"header-cell-style":{background:"#0F1420",color:"#fff"},"row-class-name":"order-table-row"},{default:s(()=>[l(g,{prop:"id",label:"订单号",width:"160"}),l(g,{label:"用户信息",width:"180"},{default:s(({row:a})=>[t("div",Le,[t("div",Te,r(a.user.name),1),t("div",Oe,r(a.user.phone_number),1)])]),_:1}),l(g,{label:"药品清单","min-width":"300"},{default:s(({row:a})=>[t("div",Ge,[(u(!0),b(M,null,S(a.items,A=>(u(),b("div",{key:A.id,class:"drug-item"},[t("span",Ue,r(A.drug.generic_name),1),t("span",Ye,"x"+r(A.quantity),1)]))),128))])]),_:1}),l(g,{prop:"total_amount",label:"总金额",width:"120"},{default:s(({row:a})=>[v(" ¥"+r(a.total_amount.toFixed(2)),1)]),_:1}),l(g,{prop:"create_time",label:"下单时间",width:"180"}),l(g,{label:"状态",width:"120"},{default:s(({row:a})=>[l(U,{status:a.order_status},null,8,["status"])]),_:1}),l(g,{label:"操作",width:"180",fixed:"right"},{default:s(({row:a})=>[l($,{type:"primary",size:"small",onClick:A=>ee(a)},{default:s(()=>[...e[10]||(e[10]=[v(" 详情 ",-1)])]),_:1},8,["onClick"]),l($,{type:"info",size:"small",onClick:A=>te(a),disabled:a.order_status===N(i).COMPLETED},{default:s(()=>[...e[11]||(e[11]=[v(" 更新状态 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[de,f.value]]),t("div",Fe,[l(ne,{"current-page":m.page,"onUpdate:currentPage":e[3]||(e[3]=a=>m.page=a),"page-size":m.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>m.pageSize=a),total:m.total,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:T,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),_:1}),l(j,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=a=>V.value=a),title:`订单详情 - #${(J=o.value)==null?void 0:J.id}`,width:"800px"},{footer:s(()=>[l($,{onClick:e[5]||(e[5]=a=>V.value=!1)},{default:s(()=>[...e[20]||(e[20]=[v("关闭",-1)])]),_:1})]),default:s(()=>[o.value?(u(),b("div",Be,[t("div",qe,[t("div",Ke,[t("div",je,[t("div",He,[e[12]||(e[12]=t("span",{class:"detail-label"},"订单号：",-1)),t("span",null,r(o.value.id),1)]),t("div",Je,[e[13]||(e[13]=t("span",{class:"detail-label"},"下单时间：",-1)),t("span",null,r(o.value.create_time),1)]),t("div",Qe,[e[14]||(e[14]=t("span",{class:"detail-label"},"订单状态：",-1)),l(U,{status:o.value.order_status},null,8,["status"])]),t("div",We,[e[15]||(e[15]=t("span",{class:"detail-label"},"总金额：",-1)),t("span",Xe,"¥"+r(o.value.total_amount.toFixed(2)),1)])])]),t("div",Ze,[e[18]||(e[18]=t("h3",{class:"section-title"},"用户信息",-1)),t("div",et,[t("div",tt,[e[16]||(e[16]=t("span",{class:"detail-label"},"姓名：",-1)),t("span",null,r(o.value.user.name),1)]),t("div",at,[e[17]||(e[17]=t("span",{class:"detail-label"},"手机号：",-1)),t("span",null,r(o.value.user.phone_number),1)])])]),t("div",lt,[e[19]||(e[19]=t("h3",{class:"section-title"},"药品清单",-1)),l(K,{data:o.value.items,style:{width:"100%"}},{default:s(()=>[l(g,{label:"药品名称",width:"200"},{default:s(({row:a})=>[v(r(a.drug.generic_name),1)]),_:1}),l(g,{prop:"drug.specification",label:"规格",width:"120"}),l(g,{label:"单价",width:"100"},{default:s(({row:a})=>[v(" ¥"+r(a.unit_price.toFixed(2)),1)]),_:1}),l(g,{prop:"quantity",label:"数量",width:"80"}),l(g,{label:"小计",width:"120"},{default:s(({row:a})=>[v(" ¥"+r(a.subtotal_amount.toFixed(2)),1)]),_:1})]),_:1},8,["data"])])])])):P("",!0)]),_:1},8,["modelValue","title"]),l(j,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=a=>_.value=a),title:`更新订单状态 - #${(Q=o.value)==null?void 0:Q.id}`,width:"500px"},{footer:s(()=>[l($,{onClick:e[8]||(e[8]=a=>_.value=!1)},{default:s(()=>[...e[21]||(e[21]=[v("取消",-1)])]),_:1}),l($,{type:"primary",onClick:ae},{default:s(()=>[...e[22]||(e[22]=[v("确认",-1)])]),_:1})]),default:s(()=>[o.value?(u(),b("div",st,[l(ie,{"label-position":"top"},{default:s(()=>[l(H,{label:"当前状态"},{default:s(()=>[l(U,{status:o.value.order_status},null,8,["status"])]),_:1}),l(H,{label:"更新为"},{default:s(()=>[l(B,{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=a=>D.value=a),placeholder:"请选择新状态"},{default:s(()=>[(u(!0),b(M,null,S(L.value,a=>(u(),x(F,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})])):P("",!0)]),_:1},8,["modelValue","title"])])}}},dt=W(ot,[["__scopeId","data-v-e20e4cdb"]]);export{dt as default};
