import{_ as te,g as i,f as oe,B as ne,c as B,d as l,w as t,r as n,E as _,a5 as re,o as I,a as d,F as ue,q as se,H as ie,N as de,O as ce,a6 as pe,J as me,G as C,i as g,S as ve}from"./index-BL_N-QZK.js";import{a as _e,b as ge,e as fe}from"./drugs-C9JUtu9W.js";import{D as p}from"./drug-B6nnaEYq.js";const be={class:"inventory-management"},ye={class:"toolbar"},Ve={class:"filter-section"},he={class:"drug-info"},Ce={class:"drug-details"},we={class:"drug-name"},ke={class:"drug-spec"},xe={class:"drug-manufacturer"},De={class:"pagination-container"},qe={__name:"Inventory",setup(ze){const R=[{value:p.OTC,label:"非处方药(OTC)"},{value:p.RX,label:"处方药(Rx)"},{value:p.MEDICAL,label:"医疗器械"},{value:p.HEALTH,label:"保健养生"}],k=i([]),x=i(!1),r=oe({page:1,pageSize:10,total:0}),D=i(""),q=i(null),f=i(null),b=i(!1),c=i(null),u=i({quantity:1,batch_number:"",production_date:"",expiry_date:""}),U=i(null),H={quantity:[{required:!0,message:"请输入入库数量",trigger:"blur"},{type:"number",min:1,message:"数量必须大于0",trigger:"blur"}],batch_number:[{required:!0,message:"请输入生产批号",trigger:"blur"}],production_date:[{required:!0,message:"请选择生产日期",trigger:"change"}],expiry_date:[{required:!0,message:"请选择有效期",trigger:"change"}]},w=i(!1),L=i([]),y=async()=>{try{x.value=!0;const o={page:r.page,pageSize:r.pageSize,keyword:D.value,category:q.value};f.value!==null&&f.value!==void 0&&(o.low_stock=f.value);try{const e=await _e(o);k.value=e.items||[],r.total=e.total||0}catch(e){_.error("获取库存列表失败: "+e.message),k.value=[],r.total=0}}catch(o){_.error("获取库存列表失败: "+o.message)}finally{x.value=!1}},V=()=>{r.page=1,y()},O=o=>{r.pageSize=o,y()},N=o=>{r.page=o,y()},K=o=>{c.value=o,u.value={quantity:1,batch_number:"",production_date:"",expiry_date:""},b.value=!0},j=async()=>{try{await U.value.validate(),await fe(c.value.id,u.value),_.success("入库成功"),b.value=!1,y()}catch(o){o.name!=="ValidationError"&&_.error("入库失败: "+o.message)}},P=async o=>{c.value=o;try{try{const e=await ge(o.id);L.value=[e],w.value=!0}catch(e){_.error("获取库存记录失败: "+e.message)}}catch(e){_.error("获取库存记录失败: "+e.message)}},X=o=>{switch(o){case p.OTC:return"success";case p.RX:return"warning";case p.MEDICAL:return"info";case p.HEALTH:return"info";default:return"info"}},G=o=>{const e=R.find(z=>z.value===o);return e?e.label:"未知"};return ne(()=>{y()}),(o,e)=>{var $,A;const z=n("el-icon"),v=n("el-button"),h=n("el-input"),S=n("el-option"),E=n("el-select"),M=n("el-card"),s=n("el-table-column"),J=n("el-image"),Q=n("el-tag"),T=n("el-table"),W=n("el-pagination"),m=n("el-form-item"),Z=n("el-input-number"),Y=n("el-date-picker"),ee=n("el-form"),F=n("el-dialog"),ae=re("loading");return I(),B("div",be,[l(M,{class:"toolbar-card",shadow:"never"},{default:t(()=>[d("div",ye,[d("div",Ve,[l(h,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=a=>D.value=a),placeholder:"搜索药品名称",clearable:"",class:"search-input",onClear:V,onKeyup:ue(V,["enter"])},{append:t(()=>[l(v,{onClick:V},{default:t(()=>[l(z,null,{default:t(()=>[l(se(ie))]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:q.value,"onUpdate:modelValue":e[1]||(e[1]=a=>q.value=a),placeholder:"全部分类",clearable:"",onChange:V},{default:t(()=>[(I(),B(de,null,ce(R,a=>l(S,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l(E,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a),placeholder:"库存状态",clearable:"",onChange:V},{default:t(()=>[l(S,{label:"正常",value:!1}),l(S,{label:"低库存",value:!0})]),_:1},8,["modelValue"])])])]),_:1}),l(M,{class:"inventory-list-card",shadow:"never"},{default:t(()=>[pe((I(),me(T,{data:k.value,style:{width:"100%"},"header-cell-style":{background:"#0F1420",color:"#fff"},"row-class-name":"inventory-table-row"},{default:t(()=>[l(s,{prop:"id",label:"ID",width:"80"}),l(s,{label:"药品信息","min-width":"300"},{default:t(({row:a})=>[d("div",he,[l(J,{src:a.image||require("@/assets/no-drugs.png"),fit:"cover",class:"drug-image"},null,8,["src"]),d("div",Ce,[d("div",we,C(a.generic_name),1),d("div",ke,C(a.specification),1),d("div",xe,C(a.manufacturer),1)])])]),_:1}),l(s,{label:"分类",width:"120"},{default:t(({row:a})=>[l(Q,{type:X(a.category)},{default:t(()=>[g(C(G(a.category)),1)]),_:2},1032,["type"])]),_:1}),l(s,{label:"当前库存",width:"120"},{default:t(({row:a})=>[d("span",{class:ve({"low-stock":a.stock_quantity<10})},C(a.stock_quantity),3)]),_:1}),l(s,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[l(v,{type:"primary",size:"small",onClick:le=>K(a)},{default:t(()=>[...e[13]||(e[13]=[g(" 入库 ",-1)])]),_:1},8,["onClick"]),l(v,{type:"info",size:"small",onClick:le=>P(a)},{default:t(()=>[...e[14]||(e[14]=[g(" 记录 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,x.value]]),d("div",De,[l(W,{"current-page":r.page,"onUpdate:currentPage":e[3]||(e[3]=a=>r.page=a),"page-size":r.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>r.pageSize=a),total:r.total,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:O,onCurrentChange:N},null,8,["current-page","page-size","total"])])]),_:1}),l(F,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=a=>b.value=a),title:`药品入库 - ${($=c.value)==null?void 0:$.generic_name}`,width:"600px"},{footer:t(()=>[l(v,{onClick:e[9]||(e[9]=a=>b.value=!1)},{default:t(()=>[...e[15]||(e[15]=[g("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:j},{default:t(()=>[...e[16]||(e[16]=[g("提交",-1)])]),_:1})]),default:t(()=>[l(ee,{ref_key:"inventoryFormRef",ref:U,model:u.value,rules:H,"label-width":"100px"},{default:t(()=>[l(m,{label:"药品名称"},{default:t(()=>{var a;return[l(h,{value:(a=c.value)==null?void 0:a.generic_name,disabled:""},null,8,["value"])]}),_:1}),l(m,{label:"规格"},{default:t(()=>{var a;return[l(h,{value:(a=c.value)==null?void 0:a.specification,disabled:""},null,8,["value"])]}),_:1}),l(m,{label:"当前库存"},{default:t(()=>{var a;return[l(h,{value:(a=c.value)==null?void 0:a.stock_quantity,disabled:""},null,8,["value"])]}),_:1}),l(m,{label:"入库数量",prop:"quantity"},{default:t(()=>[l(Z,{modelValue:u.value.quantity,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.quantity=a),min:1,max:1e4,"controls-position":"right"},null,8,["modelValue"])]),_:1}),l(m,{label:"生产批号",prop:"batch_number"},{default:t(()=>[l(h,{modelValue:u.value.batch_number,"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.batch_number=a)},null,8,["modelValue"])]),_:1}),l(m,{label:"生产日期",prop:"production_date"},{default:t(()=>[l(Y,{modelValue:u.value.production_date,"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.production_date=a),type:"date",placeholder:"选择生产日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(m,{label:"有效期至",prop:"expiry_date"},{default:t(()=>[l(Y,{modelValue:u.value.expiry_date,"onUpdate:modelValue":e[8]||(e[8]=a=>u.value.expiry_date=a),type:"date",placeholder:"选择有效期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(F,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=a=>w.value=a),title:`库存记录 - ${(A=c.value)==null?void 0:A.generic_name}`,width:"800px"},{footer:t(()=>[l(v,{onClick:e[11]||(e[11]=a=>w.value=!1)},{default:t(()=>[...e[17]||(e[17]=[g("关闭",-1)])]),_:1})]),default:t(()=>[l(T,{data:L.value,height:"400"},{default:t(()=>[l(s,{prop:"batch_number",label:"批号",width:"120"}),l(s,{prop:"quantity",label:"数量",width:"80"}),l(s,{prop:"production_date",label:"生产日期",width:"120"}),l(s,{prop:"expiry_date",label:"有效期",width:"120"}),l(s,{prop:"create_time",label:"入库时间",width:"180"}),l(s,{prop:"create_user_name",label:"操作人"})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}}},Ue=te(qe,[["__scopeId","data-v-f0fd4d77"]]);export{Ue as default};
