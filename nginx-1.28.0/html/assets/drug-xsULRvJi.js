import{P as g,g as a,p as S,u as y}from"./index-BL_N-QZK.js";import{f as h}from"./drugs-C9JUtu9W.js";import{u as C}from"./cart-DpE0VXk7.js";import{u as w,M as D}from"./notification-ClN9ZDup.js";const I=g("drug",()=>{const r=a([]),s=a(!1),i=a(null),c=a(""),n=a("default"),l=async()=>{try{s.value=!0;const e=await h();r.value=e}catch(e){i.value=e.message||"获取药品列表失败",console.error("获取药品列表失败:",e)}finally{s.value=!1}},u=async e=>{try{s.value=!0,c.value=e;const t=await u(e);r.value=t.data}catch(t){i.value=t.message||"搜索药品失败",console.error("搜索药品失败:",t)}finally{s.value=!1}},f=e=>{n.value=e},d=e=>{C().addItem(e)},p=e=>{const t=y(),o=w(),v={title:"用药咨询请求",content:`用户 ${t.userName} 请求咨询药品: ${e.generic_name}`,messageType:D.MEDICAL_CONSULT,drugId:e.id};o.addNotification(v)},m=S(()=>{let e=[...r.value];if(c.value){const t=c.value.toLowerCase();e=e.filter(o=>o.generic_name.toLowerCase().includes(t)||o.indications&&o.indications.toLowerCase().includes(t))}return n.value==="price_asc"?e.sort((t,o)=>t.price-o.price):n.value==="price_desc"&&e.sort((t,o)=>o.price-t.price),e});return{drugs:r,loading:s,error:i,searchKeyword:c,sortOption:n,filteredDrugs:m,loadDrugs:l,searchDrugs:u,setSortOption:f,addToCart:d,consultPharmacist:p}});export{I as u};
