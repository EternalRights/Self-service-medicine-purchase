import{P as g,g as a,p as S,u as y}from"./index-DJk0sxxz.js";import{u as h}from"./cart-DDlo1PfU.js";import{u as C,M as w}from"./notification-D9l_MbAS.js";const N=g("drug",()=>{const r=a([]),o=a(!1),i=a(null),c=a(""),n=a("default"),u=async()=>{try{o.value=!0;const e=await u();r.value=e.data}catch(e){i.value=e.message||"获取药品列表失败",console.error("获取药品列表失败:",e)}finally{o.value=!1}},l=async e=>{try{o.value=!0,c.value=e;const t=await l(e);r.value=t.data}catch(t){i.value=t.message||"搜索药品失败",console.error("搜索药品失败:",t)}finally{o.value=!1}},d=e=>{n.value=e},f=e=>{h().addItem(e)},p=e=>{const t=y(),s=C(),v={title:"用药咨询请求",content:`用户 ${t.userName} 请求咨询药品: ${e.generic_name}`,messageType:w.MEDICAL_CONSULT,drugId:e.id};s.addNotification(v)},m=S(()=>{let e=[...r.value];if(c.value){const t=c.value.toLowerCase();e=e.filter(s=>s.generic_name.toLowerCase().includes(t)||s.indications&&s.indications.toLowerCase().includes(t))}return n.value==="price_asc"?e.sort((t,s)=>t.price-s.price):n.value==="price_desc"&&e.sort((t,s)=>s.price-t.price),e});return{drugs:r,loading:o,error:i,searchKeyword:c,sortOption:n,filteredDrugs:m,fetchDrugs:u,searchDrugs:l,setSortOption:d,addToCart:f,consultPharmacist:p}});export{N as u};
