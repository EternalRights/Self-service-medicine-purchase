import{_ as Ve,g as p,f as he,B as we,c as C,d as a,w as t,r as u,E as f,a5 as Ce,o as b,a as n,i as _,q as h,F as De,H as Se,N as I,O as Y,a6 as Fe,J as P,C as ee,G as r,S as xe,a7 as ke}from"./index-DJk0sxxz.js";import{D as g,S as y,a as Ue,u as Le,b as Ee,c as Oe,d as ze}from"./drug-Bt3Vo8lX.js";const He={class:"drug-management"},Me={class:"toolbar"},qe=["src"],Ne={class:"filter-section"},Re={class:"drug-info"},Te={class:"drug-details"},Be={key:0,class:"rx-warning"},Ie={class:"drug-name"},Ye={class:"drug-spec"},Pe={class:"drug-manufacturer"},Ae={class:"pagination-container"},$e={key:0,class:"drug-detail"},je={class:"detail-header"},Ke={class:"detail-info"},Xe={class:"detail-name"},Ge={class:"detail-spec"},Je={class:"detail-manufacturer"},We={class:"detail-status"},Qe={class:"detail-section"},Ze={class:"detail-item"},ea={class:"detail-item"},aa={class:"detail-item"},la={class:"detail-item"},ta={class:"detail-item"},oa={__name:"DrugManagement",setup(sa){const ae=new URL("/assets/medicine-box-BixbYBSc.png",import.meta.url).href,E=[{value:g.OTC,label:"非处方药(OTC)"},{value:g.RX,label:"处方药(Rx)"},{value:g.MEDICAL,label:"医疗器械"},{value:g.HEALTH,label:"保健养生"}],le=[{value:y.ON_SHELF,label:"上架"},{value:y.OFF_SHELF,label:"下架"}],A=p([]),O=p(!1),m=he({page:1,pageSize:10,total:0}),z=p(""),H=p(null),M=p(null),w=p(!1),D=p(!1),s=p({generic_name:"",category:g.OTC,specification:"",manufacturer:"",image:null,composition:"",indications:"",usage_dosage:"",precautions:"",expiry_date:null}),te={generic_name:[{required:!0,message:"请输入药品通用名",trigger:"blur"}],category:[{required:!0,message:"请选择药品分类",trigger:"change"}]},x=p(!1),i=p(null),q=p("basic"),N=p([]),S=async()=>{try{O.value=!0;const o={page:m.page,pageSize:m.pageSize,keyword:z.value,category:H.value,shelf_status:M.value},e=await Ue(o);A.value=e.data.items,m.total=e.data.total}catch(o){f.error("获取药品列表失败: "+o.message)}finally{O.value=!1}},F=()=>{m.page=1,S()},oe=o=>{m.pageSize=o,S()},se=o=>{m.page=o,S()},ne=()=>{D.value=!1,s.value={generic_name:"",category:g.OTC,specification:"",manufacturer:"",image:null,composition:"",indications:"",usage_dosage:"",precautions:"",expiry_date:null},w.value=!0},ue=o=>{D.value=!0,s.value={...o},w.value=!0},ie=async()=>{try{if(D.value){const o=new FormData;Object.keys(s.value).forEach(e=>{e!=="imageFile"&&e!=="imagePreview"&&o.append(e,s.value[e])}),s.value.imageFile&&o.append("image",s.value.imageFile),await Oe(s.value.id,o),f.success("药品信息更新成功")}else{const o=new FormData;Object.keys(s.value).forEach(e=>{e!=="imageFile"&&e!=="imagePreview"&&o.append(e,s.value[e])}),s.value.imageFile&&o.append("image",s.value.imageFile),await ze(o),f.success("药品创建成功")}w.value=!1,S()}catch(o){f.error("操作失败: "+o.message)}},re=async o=>{try{o.updatingStatus=!0,await Le(o.id,{shelf_status:o.shelf_status}),f.success("状态更新成功")}catch(e){f.error("状态更新失败: "+e.message),o.shelf_status=o.shelf_status===y.ON_SHELF?y.OFF_SHELF:y.ON_SHELF}finally{o.updatingStatus=!1}},de=async o=>{i.value=o,q.value="basic";try{const e=await Ee(o.id);N.value=e.data}catch(e){f.error("获取库存记录失败: "+e.message),N.value=[]}x.value=!0},ce=o=>{const e=o.type.startsWith("image/"),d=o.size/1024/1024<2;return e?d?!0:(f.error("图片大小不能超过 2MB"),!1):(f.error("只能上传图片文件"),!1)},pe=async({file:o})=>{try{s.value.imageFile=o;const e=new FileReader;e.onload=d=>{s.value.imagePreview=d.target.result},e.readAsDataURL(o)}catch(e){f.error("图片上传失败: "+e.message)}},$=o=>{switch(o){case g.OTC:return"success";case g.RX:return"warning";case g.MEDICAL:return"info";case g.HEALTH:return"";default:return"info"}},j=o=>{const e=E.find(d=>d.value===o);return e?e.label:"未知"};return we(()=>{S()}),(o,e)=>{var Z;const d=u("el-button"),K=u("el-icon"),V=u("el-input"),R=u("el-option"),T=u("el-select"),X=u("el-card"),c=u("el-table-column"),B=u("el-image"),k=u("el-tag"),me=u("el-switch"),G=u("el-table"),_e=u("el-pagination"),J=u("el-tab-pane"),ge=u("el-tabs"),W=u("el-dialog"),v=u("el-form-item"),U=u("el-col"),Q=u("el-row"),ve=u("el-upload"),fe=u("el-date-picker"),be=u("el-form"),ye=Ce("loading");return b(),C("div",He,[a(X,{class:"toolbar-card",shadow:"never"},{default:t(()=>[n("div",Me,[a(d,{type:"primary",onClick:ne},{default:t(()=>[n("img",{src:h(ae),alt:"新增药品",class:"button-icon"},null,8,qe),e[19]||(e[19]=_(" 新增药品 ",-1))]),_:1}),n("div",Ne,[a(V,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=l=>z.value=l),placeholder:"搜索药品名称",clearable:"",class:"search-input",onClear:F,onKeyup:De(F,["enter"])},{append:t(()=>[a(d,{onClick:F},{default:t(()=>[a(K,null,{default:t(()=>[a(h(Se))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(T,{modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=l=>H.value=l),placeholder:"全部分类",clearable:"",onChange:F},{default:t(()=>[(b(),C(I,null,Y(E,l=>a(R,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(T,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=l=>M.value=l),placeholder:"全部状态",clearable:"",onChange:F},{default:t(()=>[(b(),C(I,null,Y(le,l=>a(R,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])]),_:1}),a(X,{class:"drug-list-card",shadow:"never"},{default:t(()=>[Fe((b(),P(G,{data:A.value,style:{width:"100%"},"header-cell-style":{background:"#0F1420",color:"#fff"},"row-class-name":"drug-table-row"},{default:t(()=>[a(c,{prop:"id",label:"ID",width:"80"}),a(c,{label:"药品信息","min-width":"300"},{default:t(({row:l})=>[n("div",Re,[a(B,{src:l.image||require("@/assets/no-drugs.png"),fit:"cover",class:"drug-image"},null,8,["src"]),n("div",Te,[l.category===h(g).RX?(b(),C("div",Be," 凭医师处方购买和使用 ")):ee("",!0),n("div",Ie,r(l.generic_name),1),n("div",Ye,r(l.specification),1),n("div",Pe,r(l.manufacturer),1)])])]),_:1}),a(c,{label:"分类",width:"120"},{default:t(({row:l})=>[a(k,{type:$(l.category)},{default:t(()=>[_(r(j(l.category)),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"库存",width:"100"},{default:t(({row:l})=>[n("span",{class:xe({"low-stock":l.stock_quantity<10})},r(l.stock_quantity),3)]),_:1}),a(c,{label:"状态",width:"100"},{default:t(({row:l})=>[a(me,{modelValue:l.shelf_status,"onUpdate:modelValue":L=>l.shelf_status=L,"active-value":h(y).ON_SHELF,"inactive-value":h(y).OFF_SHELF,loading:l.updatingStatus,onChange:L=>re(l)},null,8,["modelValue","onUpdate:modelValue","active-value","inactive-value","loading","onChange"])]),_:1}),a(c,{label:"有效期",width:"120"},{default:t(({row:l})=>[_(r(l.expiry_date||"--"),1)]),_:1}),a(c,{label:"操作",width:"180",fixed:"right"},{default:t(({row:l})=>[a(d,{type:"primary",size:"small",onClick:L=>ue(l)},{default:t(()=>[...e[20]||(e[20]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(d,{type:"info",size:"small",onClick:L=>de(l)},{default:t(()=>[...e[21]||(e[21]=[_(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,O.value]]),n("div",Ae,[a(_e,{"current-page":m.page,"onUpdate:currentPage":e[3]||(e[3]=l=>m.page=l),"page-size":m.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>m.pageSize=l),total:m.total,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:oe,onCurrentChange:se},null,8,["current-page","page-size","total"])])]),_:1}),a(W,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=l=>x.value=l),title:(Z=i.value)==null?void 0:Z.generic_name,width:"800px"},{footer:t(()=>[a(d,{onClick:e[6]||(e[6]=l=>x.value=!1)},{default:t(()=>[...e[27]||(e[27]=[_("关闭",-1)])]),_:1})]),default:t(()=>[i.value?(b(),C("div",$e,[n("div",je,[a(B,{src:i.value.image||require("@/assets/no-drugs.png"),fit:"cover",class:"detail-image"},null,8,["src"]),n("div",Ke,[n("div",Xe,r(i.value.generic_name),1),n("div",Ge,r(i.value.specification),1),n("div",Je,r(i.value.manufacturer),1),n("div",We,[a(k,{type:$(i.value.category)},{default:t(()=>[_(r(j(i.value.category)),1)]),_:1},8,["type"]),a(k,{type:i.value.shelf_status===h(y).ON_SHELF?"success":"info"},{default:t(()=>[_(r(i.value.shelf_status===h(y).ON_SHELF?"上架中":"已下架"),1)]),_:1},8,["type"]),a(k,{type:i.value.stock_quantity<10?"danger":"success"},{default:t(()=>[_(" 库存: "+r(i.value.stock_quantity),1)]),_:1},8,["type"])])])]),a(ge,{modelValue:q.value,"onUpdate:modelValue":e[5]||(e[5]=l=>q.value=l),class:"detail-tabs"},{default:t(()=>[a(J,{label:"基本信息",name:"basic"},{default:t(()=>[n("div",Qe,[n("div",Ze,[e[22]||(e[22]=n("span",{class:"detail-label"},"成分：",-1)),n("span",null,r(i.value.composition||"--"),1)]),n("div",ea,[e[23]||(e[23]=n("span",{class:"detail-label"},"适应症：",-1)),n("span",null,r(i.value.indications||"--"),1)]),n("div",aa,[e[24]||(e[24]=n("span",{class:"detail-label"},"用法用量：",-1)),n("span",null,r(i.value.usage_dosage||"--"),1)]),n("div",la,[e[25]||(e[25]=n("span",{class:"detail-label"},"注意事项：",-1)),n("span",null,r(i.value.precautions||"--"),1)]),n("div",ta,[e[26]||(e[26]=n("span",{class:"detail-label"},"有效期：",-1)),n("span",null,r(i.value.expiry_date||"--"),1)])])]),_:1}),a(J,{label:"库存记录",name:"inventory"},{default:t(()=>[a(G,{data:N.value,height:"300"},{default:t(()=>[a(c,{prop:"batch_number",label:"批号",width:"120"}),a(c,{prop:"quantity",label:"数量",width:"80"}),a(c,{prop:"create_time",label:"入库时间",width:"180"}),a(c,{prop:"expiry_date",label:"有效期",width:"120"}),a(c,{prop:"create_user_name",label:"操作人"})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])])):ee("",!0)]),_:1},8,["modelValue","title"]),a(W,{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=l=>w.value=l),title:D.value?"编辑药品信息":"新增药品",width:"800px"},{footer:t(()=>[a(d,{onClick:e[17]||(e[17]=l=>w.value=!1)},{default:t(()=>[...e[28]||(e[28]=[_("取消",-1)])]),_:1}),a(d,{type:"primary",onClick:ie},{default:t(()=>[_(r(D.value?"更新":"创建"),1)]),_:1})]),default:t(()=>[a(be,{ref:"drugFormRef",model:s.value,rules:te,"label-width":"120px","label-position":"top"},{default:t(()=>[a(Q,{gutter:20},{default:t(()=>[a(U,{span:12},{default:t(()=>[a(v,{label:"药品通用名",prop:"generic_name"},{default:t(()=>[a(V,{modelValue:s.value.generic_name,"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.generic_name=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(U,{span:12},{default:t(()=>[a(v,{label:"分类",prop:"category"},{default:t(()=>[a(T,{modelValue:s.value.category,"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.category=l),placeholder:"请选择分类"},{default:t(()=>[(b(),C(I,null,Y(E,l=>a(R,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(Q,{gutter:20},{default:t(()=>[a(U,{span:12},{default:t(()=>[a(v,{label:"规格",prop:"specification"},{default:t(()=>[a(V,{modelValue:s.value.specification,"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.specification=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(U,{span:12},{default:t(()=>[a(v,{label:"生产厂家",prop:"manufacturer"},{default:t(()=>[a(V,{modelValue:s.value.manufacturer,"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.manufacturer=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(v,{label:"药品图片"},{default:t(()=>[a(ve,{class:"image-uploader",action:"#","show-file-list":!1,"before-upload":ce,"http-request":pe},{default:t(()=>[s.value.imagePreview?(b(),P(B,{key:0,src:s.value.imagePreview,class:"uploaded-image",fit:"cover"},null,8,["src"])):(b(),P(K,{key:1,class:"image-uploader-icon"},{default:t(()=>[a(h(ke))]),_:1}))]),_:1})]),_:1}),a(v,{label:"成分",prop:"composition"},{default:t(()=>[a(V,{modelValue:s.value.composition,"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.composition=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),a(v,{label:"适应症（功能主治）",prop:"indications"},{default:t(()=>[a(V,{modelValue:s.value.indications,"onUpdate:modelValue":e[13]||(e[13]=l=>s.value.indications=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),a(v,{label:"用法用量",prop:"usage_dosage"},{default:t(()=>[a(V,{modelValue:s.value.usage_dosage,"onUpdate:modelValue":e[14]||(e[14]=l=>s.value.usage_dosage=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),a(v,{label:"注意事项",prop:"precautions"},{default:t(()=>[a(V,{modelValue:s.value.precautions,"onUpdate:modelValue":e[15]||(e[15]=l=>s.value.precautions=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),a(v,{label:"有效期",prop:"expiry_date"},{default:t(()=>[a(fe,{modelValue:s.value.expiry_date,"onUpdate:modelValue":e[16]||(e[16]=l=>s.value.expiry_date=l),type:"date",placeholder:"选择有效期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ia=Ve(oa,[["__scopeId","data-v-05ffe4c8"]]);export{ia as default};
